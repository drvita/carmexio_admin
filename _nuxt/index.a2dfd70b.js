import $ from"./Icon.1a0e11b7.js";import{_ as E,a as O,b as P,c as B}from"./Bar.999a5d1b.js";import{u as y}from"./useToast.221f038c.js";import{A as F}from"./apiV1.b7abf212.js";import{_ as b}from"./_plugin-vue_export-helper.c27b6911.js";import{k as c,l as u,m as a,t as d,z as w,F as v,A as S,B as T,q as i,v as x,C as A,s as f,_ as D}from"./entry.3656eccc.js";import{_ as N,a as V,b as q,c as G,d as z}from"./BtnSave.d8686517.js";import{_ as L,a as I}from"./modal.d2aa6b1f.js";import"./config.b6453272.js";import"./useStorage.48e4a811.js";class C extends F{async get(n=0,o={}){return this.method="GET",this.path="admins/list",this.params=o,n===0?this.path="admins":n&&(this.path="admins/"+n),new Promise(async(r,e)=>await this.request().then(s=>{if(s.type==="server error")return e(s);r(s.response)}))}async set(n){return this.method="POST",this.path="admins",this.params={},this.body=n,n.password||(n.password=this.randString(16)+"#"),new Promise(async(o,r)=>await this.request().then(e=>{if(e.type==="server error")return r(e);o(e.response)}))}async update(n,o){return this.method="PUT",this.path=`admins/${n}`,this.params={},this.body=o,new Promise(async(r,e)=>await this.request().then(s=>{if(s.type==="server error")return e(s);r(s.response)}))}async delete(n){return this.method="DELETE",this.path=`admins/${n}`,this.params={},this.body={},new Promise(async(o,r)=>await this.request().then(e=>{if(e.type==="server error")return r(e);o(e.response)}))}}const U={props:{saved:{type:Boolean}},data(){return{data:[],paginate:{},loading:!1,page:1}},methods:{handleClickPage(t){switch(t){case"next":this.page++;break;case"prev":this.page--;break;default:this.page=t}},hanleEdit(t){const n=this.data.find(o=>o.id===t);this.$emit("onEdit",n)},hanleDelete(t){const{toast_success:n,toast_question:o}=y();o(this.$t("Are you sure do this action?"),this.$t("Yes")).then(r=>{if(r.isConfirmed){const e=new C;this.loading=!0,e.delete(t).then(()=>{console.log("[Admin] Admin deleted:",t),n(this.$t("Admin deleted")),this.getAdmins()}).catch(s=>{console.error("[Admin] error put:",(s==null?void 0:s.message)??s),toast_error(this.$t("Sorry, we have error in server, try again later")),this.loading=!1})}})},async getAdmins(){const t=new C,{data:n,meta:o,links:r}=await t.get(null,{page:this.page}).catch(e=>({}));this.data=n??[],this.paginate={...o??{},links:{...r??{}}},this.loading=!1}},watch:{page(){this.getAdmins()},saved(){this.saved&&this.getAdmins()}},mounted(){this.loading=!0,this.getAdmins()}},M={class:"min-w-full divide-y divide-gray-300"},j={class:"bg-gray-100"},Y={scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"},H={scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell"},J={scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell"},K={scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell"},Q={scope:"col",class:"relative py-3.5 pl-3 pr-4 sm:pr-6"},R={class:"sr-only"},W={key:0},X={colspan:"5",class:"bg-green-500"},Z={class:"text-center text-base text-white"},ee={class:"border-t border-gray-200 py-4 text-center"},te={class:"border-t border-gray-200"},ne={class:"border-t border-gray-200 text-sm text-gray-600"},se={class:"border-t border-gray-200"},ae={class:"border-t border-gray-200 space-x-2"};function oe(t,n,o,r,e,s){const m=$,h=E,p=O,_=P;return c(),u(v,null,[a("table",M,[a("thead",null,[a("tr",j,[a("th",Y,d(t.$t("Id")),1),a("th",H,d(t.$t("Name")),1),a("th",J,d(t.$t("Email")),1),a("th",K,d(t.$t("Gender")),1),a("th",Q,[a("span",R,d(t.$t("Select")),1)])])]),a("tbody",null,[e.loading?(c(),u("tr",W,[a("td",X,[a("h4",Z,d(t.$t("Loading"))+"...",1)])])):w("",!0),(c(!0),u(v,null,S(e.data,l=>(c(),u("tr",{key:l.id,class:T([e.loading?"opacity-10":"","text-sm"])},[a("td",ee," #"+d(l.id),1),a("td",te,[i(m,{name:"wpf:administrator"}),x(" "+d(l.name),1)]),a("td",ne,[i(m,{name:"wpf:message-outline"}),x(" "+d(l.email),1)]),a("td",se,[i(m,{name:`mdi:gender-${l.gender}`,size:"1.2rem"},null,8,["name"]),x(" "+d(t.$t(l.gender)),1)]),a("td",ae,[i(h,{id:l.id,onOnClick:s.hanleEdit},null,8,["id","onOnClick"]),i(p,{id:l.id,onOnClick:s.hanleDelete},null,8,["id","onOnClick"])])],2))),128))])]),i(_,{meta:e.paginate,onClickPage:s.handleClickPage,onChangePage:s.handleClickPage},null,8,["meta","onClickPage","onChangePage"])],64)}const ie=b(U,[["render",oe]]),re={props:{data:{type:Object}},data(){return{form:{id:0,name:"",gender:"",email:""},loading:!1}},methods:{handleFormChange({target:t},n){this.form[n]=t.value},handleBtnSave(){if(!this.formValidation()){console.error("[Admins] Form inValid");return}const t=new C,n=this.getModelData(),{toast_error:o,toast_success:r}=y();if(this.form.id){t.update(this.form.id,n).then(({data:e})=>{e&&(console.log("[Admin] Admin updated:",e.id),r(this.$t("Admin updated")),this.$emit("saved",e.id),this.handleClose())}).catch(e=>{console.error("[Admin] error put:",(e==null?void 0:e.message)??e),o(this.$t("Sorry, we have error in server, try again later"))});return}t.set(n).then(({data:e})=>{e&&(console.log("[Admin] Admin saved:",e.id),r(this.$t("Admin saved")),this.$emit("saved",e.id),this.handleClose())}).catch(e=>{console.error("[Admin] error post:",(e==null?void 0:e.message)??e),o(this.$t("Sorry, we have error in server, try again later"))})},getModelData(){return{name:this.form.name,gender:this.form.gender,email:this.form.email}},formValidation(){const{toast_error:t}=y(),n={...this.form},o=/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;return n.name.length<6?(t(this.$t("Please, type name with least 6 characters")),!1):n.gender?o.test(n.email)?!0:(t(this.$t("Please, type a email valid")),!1):(t(this.$t("Please, select a gender")),!1)},handleClose(){this.$emit("onClose")},setData(){this.data&&(this.form={id:this.data.id,name:this.data.name,gender:this.data.gender,email:this.data.email})}},computed:{dataGender(){const t=[{id:"female",name:this.$t("female")},{id:"male",name:this.$t("male")}];return t.map((n,o)=>{if(n.id===this.form.gender){t[o].selected=!0;return}t[o].selected=!1}),t},title(){return this.form.id?this.$t("Edit admin"):this.$t("New admin")}},mounted(){this.setData()}},le={class:"grid grid-cols-2 gap-4"},de=a("hr",{class:"my-4"},null,-1),me={class:"grid grid-cols-2 gap-2"};function ce(t,n,o,r,e,s){const m=N,h=V,p=q,_=L,l=G,g=z,k=I;return c(),A(k,{title:s.title,onOnClose:s.handleClose},{default:f(()=>[i(_,null,{default:f(()=>[a("div",le,[a("div",null,[i(m,{label:"Name",to:"name"}),i(h,{defaultText:e.form.name,id:"name",placeholder:"Adolfo Perez",onOnChange:s.handleFormChange},null,8,["defaultText","onOnChange"])]),a("div",null,[i(m,{label:"Gender",to:"gender"}),i(p,{data:s.dataGender,id:"gender",onOnChange:s.handleFormChange},null,8,["data","onOnChange"])])])]),_:1}),i(_,null,{default:f(()=>[i(m,{label:"Email",to:"email"}),i(h,{disabled:e.form.id,defaultText:e.form.email,id:"email",type:"email",placeholder:"myemail@example.org",onOnChange:s.handleFormChange},null,8,["disabled","defaultText","onOnChange"])]),_:1}),de,a("div",me,[i(l,{large:"",onOnClick:s.handleClose},null,8,["onOnClick"]),i(g,{onOnClick:s.handleBtnSave},null,8,["onOnClick"])])]),_:1},8,["title","onOnClose"])}const he=b(re,[["render",ce]]),_e={data(){return{showForm:!1,saved:!1,dataUser:{}}},methods:{handleEdit(t){this.dataUser=t,this.showForm=!0},handleAdd(){this.showForm=!0}},computed:{saveAdmin(){return!this.showForm&&this.saved}}},pe={class:"px-4 sm:px-6 lg:px-8"},ue={class:"sm:flex sm:items-center"},ge={class:"sm:flex-auto flex text-blue-950"},fe={class:"text-2xl font-semibold leading-6 ml-2"},xe={class:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none"},ye={class:"-mx-4 mt-10 ring-1 ring-gray-300 sm:mx-0 sm:rounded-lg"};function ve(t,n,o,r,e,s){const m=$,h=B,p=ie,_=D,l=he;return c(),u(v,null,[i(_,null,{default:f(()=>[a("div",pe,[a("div",ue,[a("div",ge,[i(m,{name:"wpf:administrator",size:"1.5rem"}),a("h2",fe,d(t.$t("Admins")),1)]),a("div",xe,[i(h,{large:"",onOnClick:s.handleAdd},null,8,["onOnClick"])])]),a("div",ye,[i(p,{saved:s.saveAdmin,onOnEdit:s.handleEdit},null,8,["saved","onOnEdit"])])])]),_:1}),e.showForm?(c(),A(l,{key:0,data:e.dataUser,onOnClose:n[0]||(n[0]=g=>this.showForm=!1),onSaved:n[1]||(n[1]=g=>e.saved=g)},null,8,["data"])):w("",!0)],64)}const Fe=b(_e,[["render",ve]]);export{Fe as default};
