import C from"./Icon.d28f6baf.js";import{_ as p}from"./_plugin-vue_export-helper.c27b6911.js";import{k as m,l as u,q as i,t as h,z as x,m as a,F as w,A as O,n as E,D as P,C as I,s as M,_ as U,v as N}from"./entry.7e45b807.js";import{_ as L,b as R,a as G,c as X,d as j}from"./BtnSave.0eb93e10.js";import{U as V,a as q,_ as z,b as W}from"./brandsHlp.9d29e013.js";import{u as _}from"./useToast.5e8047f0.js";import{A as H}from"./apiV1.6105319e.js";import"./config.e10c9340.js";import"./useStorage.6e19b9e8.js";const J={props:{label:{type:String,default:"Back"},id:{type:Number},disabled:{type:Boolean},large:{type:Boolean}},methods:{handleClick(){this.$emit("onClick",this.id)}}},Y=["disabled","title","alt"],K={key:0,class:"ml-1"};function Q(e,t,s,r,o,n){const l=C;return m(),u("button",{type:"button",onClick:t[0]||(t[0]=(...c)=>n.handleClick&&n.handleClick(...c)),disabled:s.disabled,title:e.$t(s.label),alt:e.$t(s.label),class:"inline-flex items-center rounded-md px-2.5 py-1.5 text-sm text-blue-950 font-semibold bg-white shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 disabled:cursor-not-allowed disabled:opacity-30 disabled:bg-gray-300"},[i(l,{name:"material-symbols:arrow-back"}),s.large?(m(),u("span",K,h(e.$t(s.label)),1)):x("",!0)],8,Y)}const Z=p(J,[["render",Q]]),ee={props:{text:{type:String,default:""},id:{type:String,default:""},name:{type:String,default:""},defaultValue:{type:String,default:""}},methods:{handleChange(e){const t=this.name?this.name:this.id;this.$emit("onChange",e,t)}}},te={class:"relative flex items-start pt-4"},se={class:"flex h-6 items-center"},ne=["id","name","checked"],ae=["for"];function oe(e,t,s,r,o,n){return m(),u("div",te,[a("div",se,[a("input",{id:s.id,name:s.name,type:"checkbox",checked:s.defaultValue,onChange:t[0]||(t[0]=(...l)=>n.handleChange&&n.handleChange(...l)),class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"},null,40,ne)]),a("label",{for:s.id,class:"ml-2 text-sm text-gray-600"},h(e.$t(s.text)),9,ae)])}const ie=p(ee,[["render",oe]]);function v(e){let t,s=e[0],r=1;for(;r<e.length;){const o=e[r],n=e[r+1];if(r+=2,(o==="optionalAccess"||o==="optionalCall")&&s==null)return;o==="access"||o==="optionalAccess"?(t=s,s=n(s)):(o==="call"||o==="optionalCall")&&(s=n((...l)=>s.call(t,...l)),t=void 0)}return s}class b extends H{convertImageToBase64(t,s){let r=new FileReader;r.readAsDataURL(t),r.onload=()=>{s&&s(t,r.result)}}async set(t,s){return this.method="POST",this.path=t,this.params={},this.body={images:s},new Promise(async(r,o)=>await this.request().then(n=>{if(n.type==="server error"||v([n,"access",l=>l.response,"optionalAccess",l=>l.errors]))return o(n);r(n.response)}))}async delete(t){return this.method="DELETE",this.path=t,this.params={},this.body={},new Promise(async(s,r)=>await this.request().then(o=>{if(o.type==="server error"||v([o,"access",n=>n.response,"optionalAccess",n=>n.errors]))return r(o);s(o.response)}))}async setVideo(t,s){return this.method="POST",this.path=t,this.params={},this.body={videos:s},new Promise(async(r,o)=>await this.request().then(n=>{if(n.type==="server error"||v([n,"access",l=>l.response,"optionalAccess",l=>l.errors]))return o(n);r(n.response)}))}}const re={props:{files:{type:Array,default:[]},carid:{type:Number}},methods:{handleWatch(e){if(console.log("[DEBUG] Request modal:",e),!(e!=null&&e.url))return;const{image:t}=_();t(e.url,this.$t("Close")).then(({isDismissed:s})=>{s&&new b().delete(`cars/${this.carid}/media/${e.id}`).then(()=>{console.log("[API] Car media success delete"),this.$emit("onDelete",e.id)}).catch(o=>console.error("[IMG] Delete image:",o.message))})},src(e){return e.url?e.url:URL.createObjectURL(e)}}},le={key:0,class:"inline-grid gap-2 grid-cols-3"},de=["src","onClick"];function ce(e,t,s,r,o,n){return s.files.length?(m(),u("div",le,[(m(!0),u(w,null,O(s.files,l=>(m(),u("div",{key:l.name,class:""},[a("img",{class:"object-contain max-h-48 max-w-96 border",src:n.src(l),onClick:c=>n.handleWatch(l)},null,8,de)]))),128))])):x("",!0)}const he=p(re,[["render",ce]]),me={props:{id:{type:Number,default:0},defaultFiles:{type:Array,default:[]},url:{type:String},carid:{type:Number}},data(){return{isDragging:!1,files:[],base64:[]}},methods:{handleSaveMedia(){if(!this.base64.length||!this.url)return;new b().set(this.url,this.base64).then(t=>{console.log("[API] Car media success upload"),this.base64=[],this.files=[],this.$emit("onUpload")})},processFile(e,t){const s=[...this.base64];s.push(t),this.base64=s,console.log("[IMG] Process to base64:",e.name)},onChange({target:e}){const t=new b;for(let s=0;s<e.files.length;s++)t.convertImageToBase64(e.files[s],this.processFile);this.files=[...this.files,...e.files]},dragover(e){e.preventDefault(),this.isDragging=!0},dragleave(){this.isDragging=!1},drop(e){e.preventDefault(),this.$refs.file.files=e.dataTransfer.files,this.onChange({target:this.$refs.file}),this.isDragging=!1}},computed:{filesImg(){return[...this.defaultFiles,...this.files]}},watch:{"base64.length":function(){this.base64.length===this.files.length&&this.handleSaveMedia()}}},ue={class:"text-center text-gray-600"},ge={class:"mt-4 flex text-sm leading-6"},fe={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-primary-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-primary-600 focus-within:ring-offset-2 hover:text-primary-500"},pe={class:"pl-1"},_e={class:"text-xs leading-5"};function be(e,t,s,r,o,n){const l=he,c=C;return m(),u(w,null,[i(l,{files:n.filesImg,carid:s.carid,onOnDelete:t[0]||(t[0]=d=>e.$emit("onUpload"))},null,8,["files","carid"]),a("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10",draggable:"",onDragover:t[2]||(t[2]=(...d)=>n.dragover&&n.dragover(...d)),onDragleave:t[3]||(t[3]=(...d)=>n.dragleave&&n.dragleave(...d)),onDrop:t[4]||(t[4]=(...d)=>n.drop&&n.drop(...d))},[a("div",ue,[i(c,{name:"wpf:image-file",size:"4rem"}),a("div",ge,[a("label",fe,[a("span",null,h(e.$t("Upload a file")),1),a("input",{id:"file-upload",multiple:"",accept:"image/*",type:"file",ref:"file",onChange:t[1]||(t[1]=(...d)=>n.onChange&&n.onChange(...d)),class:"sr-only"},null,544)]),a("p",pe,h(e.$t("or drag and drop")),1)]),a("p",_e,"PNG, JPG, GIF "+h(e.$t("up to"))+" 10MB",1)])],32)],64)}const ye=p(me,[["render",be]]),ve={data(){return{form:{id:0,brand:"",model:"",year:"",transmition:"",status:"",color:"",price:"",currency:"",specifications:"",version:"",cylinders:"",type:"",national:!1},inputVideos:[],brands:[],brand:{},files:[],createdBy:{},load_brand:!1}},methods:{handleRemoveVideo(e){let t=[...this.inputVideos];t=t.filter(s=>s.id!==e),this.inputVideos=t,t.length||this.handleAddVideo()},getDataVideo(e,t){return{id:t??"video_"+Date.now(),url:e??""}},handleAddVideo(e,t){let s=[...this.inputVideos];t?(s=s.filter(r=>r.id!==t),s.push(this.getDataVideo(e,t))):s.push(this.getDataVideo(e)),this.inputVideos=s},handleSave(e){if(e.preventDefault(),!this.formValidation()){console.error("[Cars] Form inValid");return}const t=this.getModelData(),s=new V,{toast_error:r,toast_success:o}=_();let n=this.inputVideos.map(c=>c.url);n=n.filter(c=>c),new b().setVideo(`cars/${this.form.id}/videos`,n).then(c=>{console.log("[API] Car videos success upload")}),s.update(this.form.id,t).then(({data:c})=>{c&&(console.log("[Car] Car updated:",c.id),o(this.$t("Car updated")),this.handleClose())}).catch(c=>{console.error("[Car] error:",c==null?void 0:c.message),r(this.$t("Sorry, we have error in server, try again later"))})},getModelData(){return{brand_id:this.form.brand,model:this.form.model,year:this.form.year,transmition:this.form.transmition,status:this.form.status,color:this.form.color,price_base:this.form.price,currency:this.form.currency,specifications:this.form.specifications,version:this.form.version,cylinders:this.form.cylinders,type:this.form.type,national:this.form.national}},formValidation(){const{toast_error:e}=_(),t={...this.form};return t.brand?t.model?t.year?t.transmition?t.status?t.price?!0:(e(this.$t("Please, type price")),!1):(e(this.$t("Please, select a status")),!1):(e(this.$t("Please, select a transmition")),!1):(e(this.$t("Please, type year")),!1):(e(this.$t("Please, type model")),!1):(e(this.$t("Please, select a brand")),!1)},handleFormChange({target:e},t){if(t==="national"){this.form.national=e.checked;return}else if(/^video_.*/i.test(t)){this.handleAddVideo(e.value,t);return}this.form[t]=e.value},handleClose(){return E("/dashboard/cars")},getCar(){if(!this.form.id)return;const e=new V,{toast_error:t}=_();e.get(this.form.id).then(({data:s})=>{this.setDataModel(s),this.brand=(s==null?void 0:s.brand)??{},this.createdBy=(s==null?void 0:s.admin)??{},this.files=s.media}).catch(s=>{console.error("[Car] error:",s.message),t(this.$t("Sorry, we have error in server, try again later"))})},setDataModel(e){var s;if(!e)return;console.log("[DEBUG] Model",e);const t={...this.form,id:e.id,brand:((s=e.brand)==null?void 0:s.id)??0,model:e.model,year:e.year,transmition:e.transmition,status:e.status,price:e.price_base,currency:e.currency,specifications:e.specifications,color:e.color,version:e.version,cylinders:e.cylinders,type:e.type,national:!!e.national};if(this.form=t,e.videos&&e.videos.length)e.videos.forEach(r=>{this.handleAddVideo(r.url,`saved_${r.id}`)});else{if(this.inputVideos.length)return;this.handleAddVideo()}},async getBrands(){const e=new q,{data:t}=await e.get(0,{perpage:200});this.brands=t??[],this.load_brand=!1}},computed:{placeholdType(){return this.$t("hatchback")},placeholdColor(){return this.$t("Color")},placeholdModel(){return this.$t("classic jetta")},placeholdVersion(){return this.$t("Version")},dataBrand(){const e=[...this.brands];return e.map(t=>{if(t.id===this.form.brand){t.selected=!0;return}t.selected=!1}),e},dataStatus(){const e=[{id:"for sale",name:this.$t("for sale")},{id:"apart",name:this.$t("apart")},{id:"saled",name:this.$t("saled")}];return e.map((t,s)=>{if(t.id===this.form.status){e[s].selected=!0;return}e[s].selected=!1}),e},dataTransmition(){const e=[{id:"automatic",name:this.$t("automatic")},{id:"standard",name:this.$t("standard")}];return e.map(t=>{if(t.id===this.form.transmition){t.selected=!0;return}t.selected=!1}),e}},watch:{"form.id":function(){this.getCar()}},mounted(){const e=P();this.form.id=e.params.id,this.load_brand=!0,this.getBrands()}},Ce={class:"px-4 sm:px-6 lg:px-8"},xe={class:"sm:flex sm:items-center"},we={class:"sm:flex-auto flex text-indigo-900"},Ve={class:"text-2xl font-semibold leading-6 ml-2"},Oe={class:"mt-4 sm:ml-16 sm:mt-0 sm:flex-none"},Te={class:"space-y-12"},ke={class:"grid grid-cols-1 gap-x-8 border-b border-gray-900/10 gap-y-10 pb-12 md:grid-cols-3"},De={class:"text-base font-semibold leading-7 text-gray-900"},Fe={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2"},Be={class:"sm:col-span-4"},Se={class:"sm:col-span-3"},$e={class:"sm:col-span-3"},Ae={class:"sm:col-span-3"},Ee={class:"sm:col-span-3"},Pe={class:"sm:col-span-3"},Ie={class:"sm:col-span-3"},Me={class:"grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3"},Ue={class:"text-base font-semibold leading-7 text-gray-900"},Ne={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2"},Le={class:"sm:col-span-3"},Re={class:"sm:col-span-3"},Ge={class:"grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3"},Xe={class:"text-base font-semibold leading-7 text-gray-900"},je={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2"},qe={class:"sm:col-span-3"},ze={class:"sm:col-span-3"},We={class:"sm:col-span-full"},He={class:"grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3"},Je={class:"text-base font-semibold leading-7 text-gray-900"},Ye={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2"},Ke={class:"col-span-full"},Qe={class:"grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3"},Ze={class:"text-base font-semibold leading-7 text-gray-900"},et={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-6 md:content-start md:grid-cols-6 col-span-2"},tt={class:"md:col-span-5"},st={class:"my-3 flex space-x-4"},nt=["onClick"],at={class:"w-full"},ot={class:"hidden md:block md:col-span-1 flex justify-end pr-2 text-blue-700"},it={class:"mt-6 px-2 grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4"},rt=a("div",{class:"hidden md:block md:col-span-2"},null,-1);function lt(e,t,s,r,o,n){const l=C,c=Z,d=L,y=R,f=G,T=z,k=ie,D=W,F=ye,B=X,S=j,$=U;return m(),I($,null,{default:M(()=>[a("div",Ce,[a("div",xe,[a("div",we,[i(l,{name:"wpf:car-rental",size:"1.5rem"}),a("h2",Ve,h(o.brand.name)+" - "+h(o.form.model),1)]),a("div",Oe,[i(c,{large:"",onOnClick:n.handleClose},null,8,["onOnClick"])])]),a("form",{class:"-mx-4 mt-10",onSubmit:t[2]||(t[2]=(...g)=>n.handleSave&&n.handleSave(...g))},[a("div",Te,[a("div",ke,[a("div",null,[a("h2",De,h(e.$t("Basic")),1)]),a("div",Fe,[a("div",Be,[i(d,{label:"Brand",to:"brand"}),i(y,{data:n.dataBrand,id:"brand",onOnChange:n.handleFormChange},null,8,["data","onOnChange"]),N(" "+h(o.load_brand?e.$t("Loading"):null),1)]),a("div",Se,[i(d,{label:"Model",to:"model"}),i(f,{id:"model",defaultText:o.form.model,placeholder:n.placeholdModel,onOnChange:n.handleFormChange},null,8,["defaultText","placeholder","onOnChange"])]),a("div",$e,[i(d,{label:"Year",to:"year"}),i(f,{id:"year",defaultText:o.form.year,placeholder:"2017",onOnChange:n.handleFormChange},null,8,["defaultText","onOnChange"])]),a("div",Ae,[i(d,{label:"Version",to:"version",optional:""}),i(f,{id:"version",defaultText:o.form.version,placeholder:n.placeholdVersion,onOnChange:n.handleFormChange},null,8,["defaultText","placeholder","onOnChange"])]),a("div",Ee,[i(d,{label:"Price",to:"price"}),i(T,{id:"price",defaultValue:o.form.price,defaultCurrency:o.form.currency,onOnChange:n.handleFormChange,onOnChangeCurrency:n.handleFormChange},null,8,["defaultValue","defaultCurrency","onOnChange","onOnChangeCurrency"])]),a("div",Pe,[i(d,{label:"Status",to:"status"}),i(y,{data:n.dataStatus,id:"status",onOnChange:n.handleFormChange},null,8,["data","onOnChange"])]),a("div",Ie,[i(k,{id:"national",text:"National",defaultValue:o.form.national,onOnChange:n.handleFormChange},null,8,["defaultValue","onOnChange"])])])]),a("div",Me,[a("div",null,[a("h2",Ue,h(e.$t("Engine")),1)]),a("div",Ne,[a("div",Le,[i(d,{label:"Transmition",to:"transmition"}),i(y,{data:n.dataTransmition,id:"transmition",onOnChange:n.handleFormChange},null,8,["data","onOnChange"])]),a("div",Re,[i(d,{label:"Cylinders",to:"cylinders"}),i(f,{id:"cylinders",defaultText:o.form.cylinders,placeholder:"V4",onOnChange:n.handleFormChange},null,8,["defaultText","onOnChange"])])])]),a("div",Ge,[a("div",null,[a("h2",Xe,h(e.$t("Details")),1)]),a("div",je,[a("div",qe,[i(d,{label:"Color",to:"color",optional:""}),i(f,{id:"color",defaultText:o.form.color,placeholder:n.placeholdColor,onOnChange:n.handleFormChange},null,8,["defaultText","placeholder","onOnChange"])]),a("div",ze,[i(d,{label:"Type",to:"type",optional:""}),i(f,{id:"type",defaultText:o.form.type,placeholder:n.placeholdType,onOnChange:n.handleFormChange},null,8,["defaultText","placeholder","onOnChange"])]),a("div",We,[i(d,{label:"Specifications",to:"specifications",optional:""}),i(D,{id:"specifications",defaultText:o.form.specifications,onOnChange:n.handleFormChange},null,8,["defaultText","onOnChange"])])])]),a("div",He,[a("div",null,[a("h2",Je,h(e.$t("Images")),1)]),a("div",Ye,[a("div",Ke,[i(d,{label:"Upload images",to:"file-upload",optional:""}),i(F,{url:`cars/${o.form.id}/media`,defaultFiles:o.files,carid:o.form.id,onOnUpload:t[0]||(t[0]=g=>n.getCar())},null,8,["url","defaultFiles","carid"])])])]),a("div",Qe,[a("div",null,[a("h2",Ze,h(e.$t("Videos")),1)]),a("div",et,[a("div",tt,[(m(!0),u(w,null,O(o.inputVideos,(g,A)=>(m(),u("div",st,[g.url?(m(),u("div",{key:0,class:"hidden md:block pt-6 text-gray-700 cursor-pointer",onClick:dt=>n.handleRemoveVideo(g.id)},[i(l,{name:"material-symbols:delete-sweep-outline",size:"1.5rem"})],8,nt)):x("",!0),a("div",at,[i(d,{label:"Url",to:g.id,optional:!A},null,8,["to","optional"]),i(f,{id:g.id,defaultText:g.url,placeholder:"https://www.youtube.com/watch?v=XXXXXXX",onOnChange:n.handleFormChange},null,8,["id","defaultText","onOnChange"])])]))),256))]),a("div",ot,[i(l,{name:"material-symbols:add-box",size:"2rem",onClick:t[1]||(t[1]=g=>n.handleAddVideo())})])])])]),a("div",it,[rt,i(B,{large:"",label:"Cerrar",onOnClick:n.handleClose},null,8,["onOnClick"]),i(S)])],32)])]),_:1})}const yt=p(ve,[["render",lt]]);export{yt as default};
