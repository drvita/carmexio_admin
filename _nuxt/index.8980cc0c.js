import P from"./Icon.43ce0162.js";import{U as b,a as T,b as D,c as M,_ as N}from"./brandsHlp.abf70b60.js";import{_ as A,a as L,b as U,c as V}from"./Bar.a23b54ba.js";import{n as $,k as u,l as g,m as n,t as i,z as k,F as x,A as z,B as y,v as I,q as s,C as v,s as _,E as j,_ as q}from"./entry.0a49ef2e.js";import{u as w}from"./useToast.c289a6d2.js";import{u as B}from"./useStorage.fdfc57c0.js";import{_ as O}from"./_plugin-vue_export-helper.c27b6911.js";import{_ as Y,b as G,a as R,c as X,d as H}from"./BtnSave.90018629.js";import{_ as J,a as K,b as Q}from"./modal.1fa3e18d.js";import"./config.583245fe.js";import"./apiV1.ad2d675e.js";const W={props:{saved:{type:Boolean}},data(){return{data:[],paginate:{},loading:!1,page:1}},methods:{handleClickPage(e){switch(e){case"next":this.page++;break;case"prev":this.page--;break;default:this.page=e}},hanleEdit(e){$("/dashboard/cars/"+e)},hanleDelete(e){const{toast_success:a,toast_error:d,toast_question:m}=w();m(this.$t("Are you sure do this action?"),this.$t("Yes")).then(r=>{if(r.isConfirmed){const t=new b;this.loading=!0,t.delete(e).then(()=>{console.log("[Car] car deleted:",e),a(this.$t("Car deleted")),this.getCars()}).catch(o=>{console.error("[Car] error:",o==null?void 0:o.message),d(this.$t("Sorry, we have error in server, try again later")),this.loading=!1})}})},async getCars(){const e=new b,{getUser:a,hasRole:d}=B(),m=a(),r={page:this.page};d("root")||(r.admin_id=m.id);const{data:t,meta:o,links:h}=await e.get(0,r);this.data=t??[],this.paginate={...o??{},links:{...h??{}}},this.loading=!1},clasStatus(e){switch(e){case"for sale":return{"text-green-800":!0};case"saled":return{"text-red-800":!0};default:return{"text-gray-800":!0}}}},watch:{page(){this.getCars()},saved(){this.saved&&this.getCars()}},mounted(){this.loading=!0,this.getCars()}},Z={class:"min-w-full divide-y divide-gray-300"},ee={scope:"col",class:"py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6"},te={scope:"col",class:"hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell"},ae={scope:"col",class:"hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell"},ne={scope:"col",class:"hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell"},se={scope:"col",class:"px-3 py-3.5 text-left text-sm font-semibold text-gray-900"},oe={scope:"col",class:"relative py-3.5 pl-3 pr-4 sm:pr-6"},le={class:"sr-only"},re={key:0},ie={colspan:"6",class:"bg-green-500"},de={class:"text-center text-base text-white"},ce={class:"hidden lg:table-cell border-t border-gray-200 lowercase"},he={class:"text-gray-500 text-sm"},me={class:"hidden lg:table-cell border-t border-gray-200 text-sm lowercase"},_e={class:"border-t border-gray-200"},ue={class:"border-t border-gray-200 space-x-2"};function ge(e,a,d,m,r,t){const o=A,h=L,c=U;return u(),g(x,null,[n("table",Z,[n("thead",null,[n("tr",null,[n("th",ee,i(e.$t("Brand")),1),n("th",te,i(e.$t("Model")),1),n("th",ae,i(e.$t("Transmition")),1),n("th",ne,i(e.$t("Status")),1),n("th",se,i(e.$t("Price")),1),n("th",oe,[n("span",le,i(e.$t("Select")),1)])])]),n("tbody",null,[r.loading?(u(),g("tr",re,[n("td",ie,[n("h4",de,i(e.$t("Loading"))+"...",1)])])):k("",!0),(u(!0),g(x,null,z(r.data,l=>(u(),g("tr",{key:l.id},[n("td",{class:y([t.clasStatus(l.status),"border-t border-gray-200 py-2 pl-2 uppercase"])},i(l.brand.name),3),n("td",ce,[I(i(l.model)+" / ",1),n("span",he,i(l.year),1)]),n("td",me,i(e.$t(l.transmition)),1),n("td",{class:y([t.clasStatus(l.status),"hidden lg:table-cell border-t border-gray-200 text-sm capitalize"])},i(e.$t(l.status)),3),n("td",_e," $ "+i(new Intl.NumberFormat().format(l.price_base))+" "+i(l.currency),1),n("td",ue,[s(o,{id:l.id,onOnClick:t.hanleEdit},null,8,["id","onOnClick"]),s(h,{id:l.id,onOnClick:t.hanleDelete},null,8,["id","onOnClick"])])]))),128))])]),s(c,{meta:r.paginate,onClickPage:t.handleClickPage,onChangePage:t.handleClickPage},null,8,["meta","onClickPage","onChangePage"])],64)}const pe=O(W,[["render",ge]]),fe={data(){return{form:{id:0,brand:"",model:"",year:"",transmition:"",status:"for sale",color:"",price:"",currency:"MXN",specifications:""},data:[],loading:!1}},methods:{handleFormChange({target:e},a){this.form[a]=e.value},handleBtnSave(){const{toast_error:e,toast_success:a}=w(),d=this.validate;if(!d.status){console.error("[Cars] Form inValid"),e(d.message);return}const m=new b,r=this.getModelData();this.loading=!0,m.set(r).then(({data:t})=>{t&&(console.log("[Car] Car saved:",t.id),a(this.$t("Car saved")),this.$emit("saved",t.id),this.handleClose()),this.loading=!1}).catch(t=>{console.error("[Car] error:",t==null?void 0:t.message),e(this.$t("Sorry, we have error in server, try again later")),this.loading=!1})},getModelData(){const{getUser:e}=B();return{brand_id:this.form.brand,model:this.form.model,year:this.form.year,transmition:this.form.transmition,status:this.form.status,color:this.form.color??"",price_base:this.form.price,currency:this.form.currency,specifications:this.form.specifications??"--",admin_id:e().id}},handleClose(){this.$emit("onClose")},async getBrands(){const e=new T,{data:a}=await e.get(0,{perpage:200});this.data=a??[]}},computed:{dataBrand(){const e=[...this.data];return e.map(a=>{if(a.id===this.form.brand){a.selected=!0;return}a.selected=!1}),e},dataStatus(){const e=[{id:"for sale",name:this.$t("for sale")},{id:"apart",name:this.$t("apart")},{id:"saled",name:this.$t("saled")}];return e.map((a,d)=>{if(a.id===this.form.status){e[d].selected=!0;return}e[d].selected=!1}),e},dataTransmition(){const e=[{id:"automatic",name:this.$t("automatic")},{id:"standard",name:this.$t("standard")}];return e.map(a=>{if(a.id===this.form.transmition){a.selected=!0;return}a.selected=!1}),e},title(){return this.form.id?this.$t("Edit car"):this.$t("New car")},placeholdColor(){return this.$t("white")},placeholdModel(){return this.$t("classic jetta")},validate(){const e={...this.form},a={status:!1,message:""};return e.brand?e.model?e.year?e.transmition?e.status?e.price?(a.status=!0,a):(a.message=this.$t("Please, type price"),a):(a.message=this.$t("Please, select a status"),a):(a.message=this.$t("Please, select a transmition"),a):(a.message=this.$t("Please, type year"),a):(a.message=this.$t("Please, type model"),a):(a.message=this.$t("Please, select a brand"),a)},btnDisabled(){return this.loading||!this.validate.status}},mounted(){this.getBrands()}},Ce={class:"grid grid-cols-2 gap-4"},be={class:"grid grid-cols-2 gap-4"},xe=n("hr",{class:"my-4"},null,-1),ye={class:"grid grid-cols-2 gap-2"};function ve(e,a,d,m,r,t){const o=Y,h=G,c=J,l=R,f=D,C=M,p=K,F=X,E=H,S=Q;return u(),v(S,{title:t.title,onOnClose:t.handleClose},{default:_(()=>[n("div",{class:y(r.loading?"opacity-50":"")},[s(c,null,{default:_(()=>[s(o,{label:"Brand",to:"brand"}),s(h,{data:t.dataBrand,id:"brand",onOnChange:t.handleFormChange},null,8,["data","onOnChange"])]),_:1}),s(c,null,{default:_(()=>[n("div",Ce,[n("div",null,[s(o,{label:"Model",to:"model"}),s(l,{id:"model",placeholder:t.placeholdModel,onOnChange:t.handleFormChange},null,8,["placeholder","onOnChange"])]),n("div",null,[s(o,{label:"Year",to:"year"}),s(l,{id:"year",placeholder:"2017",onOnChange:t.handleFormChange},null,8,["onOnChange"])])])]),_:1}),s(c,null,{default:_(()=>[s(o,{label:"Transmition",to:"transmition"}),s(h,{data:t.dataTransmition,id:"transmition",onOnChange:t.handleFormChange},null,8,["data","onOnChange"])]),_:1}),s(c,null,{default:_(()=>[n("div",be,[n("div",null,[s(o,{label:"Status",to:"status"}),s(h,{data:t.dataStatus,id:"status",onOnChange:t.handleFormChange},null,8,["data","onOnChange"])]),n("div",null,[s(o,{label:"Color",to:"color",optional:""}),s(l,{id:"color",placeholder:t.placeholdColor,onOnChange:t.handleFormChange},null,8,["placeholder","onOnChange"])])])]),_:1}),s(c,null,{default:_(()=>[s(o,{label:"Price",to:"price"}),s(f,{id:"price",onOnChange:t.handleFormChange,onOnChangeCurrency:t.handleFormChange},null,8,["onOnChange","onOnChangeCurrency"])]),_:1}),s(c,null,{default:_(()=>[s(o,{label:"Specifications",to:"specifications",optional:""}),s(C,{id:"specifications",onOnChange:t.handleFormChange},null,8,["onOnChange"])]),_:1}),xe,r.loading?(u(),v(p,{key:0})):k("",!0),n("div",ye,[s(F,{large:"",onOnClick:t.handleClose},null,8,["onOnClick"]),s(E,{disabled:t.btnDisabled,onOnClick:t.handleBtnSave},null,8,["disabled","onOnClick"])])],2)]),_:1},8,["title","onOnClose"])}const $e=O(fe,[["render",ve]]),ke={data(){return{showForm:!1,saved:!1}},methods:{handleBack(){$("/dashboard")},handleAdd(){this.showForm=!0}},computed:{saveCar(){return!this.showForm&&this.saved}},watch:{showForm(){this.showForm&&(this.saved=!1)}}},Oe={class:"px-4 sm:px-6 md:px-8"},we={class:"flex flex-col md:flex-row items-start"},Be={class:"flex-auto flex w-full text-indigo-900"},Fe={class:"text-2xl font-semibold leading-6 ml-2"},Ee={class:"flex space-x-2 justify-end w-full pt-2 md:pt-0"},Se={class:"md:-mx-4 mt-4 md:mt-10 ring-1 ring-gray-300 rounded-lg"};function Pe(e,a,d,m,r,t){const o=P,h=N,c=V,l=pe,f=q,C=$e;return u(),g(x,null,[s(f,null,{default:_(()=>[n("div",Oe,[n("div",we,[n("div",Be,[s(o,{name:"wpf:car-rental",size:"1.5rem"}),n("h2",Fe,i(e.$t("Cars")),1)]),n("div",Ee,[s(h,{large:"",onOnClick:t.handleBack,class:"block md:hidden"},null,8,["onOnClick"]),s(c,{large:"",onOnClick:t.handleAdd},null,8,["onOnClick"])])]),n("div",Se,[s(l,{saved:t.saveCar},null,8,["saved"])])])]),_:1}),r.showForm?(u(),v(C,{key:0,onOnClose:a[0]||(a[0]=p=>this.showForm=!1),onSaved:a[1]||(a[1]=p=>("navigateTo"in e?e.navigateTo:j($))("cars/"+p))})):k("",!0)],64)}const qe=O(ke,[["render",Pe]]);export{qe as default};
