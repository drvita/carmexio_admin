import w from"./Icon.43ce0162.js";import{U as C,a as P,_ as E,b as I,c as M}from"./brandsHlp.abf70b60.js";import{_ as U,b as N,a as L,c as j,d as R}from"./BtnSave.90018629.js";import{_ as y}from"./_plugin-vue_export-helper.c27b6911.js";import{k as u,l as f,m as a,t as h,F as x,A as V,z as O,q as i,n as X,D as z,C as G,s as q,_ as W,v as H}from"./entry.0a49ef2e.js";import{u as g}from"./useToast.c289a6d2.js";import{A as J}from"./apiV1.ad2d675e.js";import"./config.583245fe.js";import"./useStorage.fdfc57c0.js";const Y={props:{text:{type:String,default:""},id:{type:String,default:""},name:{type:String,default:""},defaultValue:{type:String,default:""}},methods:{handleChange(e){const t=this.name?this.name:this.id;this.$emit("onChange",e,t)}}},K={class:"relative flex items-start pt-4"},Q={class:"flex h-6 items-center"},Z=["id","name","checked"],ee=["for"];function te(e,t,n,r,o,s){return u(),f("div",K,[a("div",Q,[a("input",{id:n.id,name:n.name,type:"checkbox",checked:n.defaultValue,onChange:t[0]||(t[0]=(...l)=>s.handleChange&&s.handleChange(...l)),class:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-600"},null,40,Z)]),a("label",{for:n.id,class:"ml-2 text-sm text-gray-600"},h(e.$t(n.text)),9,ee)])}const se=y(Y,[["render",te]]);function v(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],s=e[r+1];if(r+=2,(o==="optionalAccess"||o==="optionalCall")&&n==null)return;o==="access"||o==="optionalAccess"?(t=n,n=s(n)):(o==="call"||o==="optionalCall")&&(n=s((...l)=>n.call(t,...l)),t=void 0)}return n}class _ extends J{convertImageToBase64(t,n){let r=new FileReader;r.readAsDataURL(t),r.onload=()=>{n&&n(t,r.result)}}async set(t,n){return this.method="POST",this.path=t,this.params={},this.body={images:n},new Promise(async(r,o)=>await this.request().then(s=>{if(s.type==="server error"||v([s,"access",l=>l.response,"optionalAccess",l=>l.errors]))return o(s);r(s.response)}))}async delete(t){return this.method="DELETE",this.path=t,this.params={},this.body={},new Promise(async(n,r)=>await this.request().then(o=>{if(o.type==="server error"||v([o,"access",s=>s.response,"optionalAccess",s=>s.errors]))return r(o);n(o.response)}))}async setVideo(t,n){return this.method="POST",this.path=t,this.params={},this.body={videos:n},new Promise(async(r,o)=>await this.request().then(s=>{if(s.type==="server error"||v([s,"access",l=>l.response,"optionalAccess",l=>l.errors]))return o(s);r(s.response)}))}}const ne={props:{files:{type:Array,default:[]},carid:{type:Number}},methods:{handleWatch(e){if(!(e!=null&&e.url))return;const{image:t}=g();t(e.url,this.$t("Close")).then(({isDismissed:n})=>{n&&new _().delete(`cars/${this.carid}/media/${e.id}`).then(()=>{console.log("[API] Car media success delete"),this.$emit("onDelete",e.id)}).catch(o=>console.error("[IMG] Delete image:",o.message))})},src(e){return e.url?e.url:URL.createObjectURL(e)}}},ae={key:0,class:"inline-grid gap-2 grid-cols-3"},oe=["src","onClick"];function ie(e,t,n,r,o,s){return n.files.length?(u(),f("div",ae,[(u(!0),f(x,null,V(n.files,l=>(u(),f("div",{key:l.name,class:""},[a("img",{class:"object-contain max-h-48 max-w-96 border",src:s.src(l),onClick:c=>s.handleWatch(l)},null,8,oe)]))),128))])):O("",!0)}const re=y(ne,[["render",ie]]),le={props:{id:{type:Number,default:0},defaultFiles:{type:Array,default:[]},url:{type:String},carid:{type:Number}},data(){return{isDragging:!1,files:[],base64:[]}},methods:{handleSaveMedia(){if(!this.base64.length||!this.url)return;new _().set(this.url,this.base64).then(t=>{console.log("[API] Car media success upload"),this.base64=[],this.files=[],this.$emit("onUpload")})},processFile(e,t){const n=[...this.base64];n.push(t),this.base64=n,console.log("[IMG] Process to base64:",e.name)},onChange({target:e}){const t=new _;for(let n=0;n<e.files.length;n++)t.convertImageToBase64(e.files[n],this.processFile);this.files=[...this.files,...e.files]},dragover(e){e.preventDefault(),this.isDragging=!0},dragleave(){this.isDragging=!1},drop(e){e.preventDefault(),this.$refs.file.files=e.dataTransfer.files,this.onChange({target:this.$refs.file}),this.isDragging=!1}},computed:{filesImg(){return[...this.defaultFiles,...this.files]}},watch:{"base64.length":function(){this.base64.length===this.files.length&&this.handleSaveMedia()}}},de={class:"text-center text-gray-600"},ce={class:"mt-4 flex text-sm leading-6 justify-center"},he={for:"file-upload",class:"relative cursor-pointer rounded-md bg-white font-semibold text-primary-600 focus-within:outline-none focus-within:ring-2 focus-within:ring-primary-600 focus-within:ring-offset-2 hover:text-primary-500"},me={class:"text-center w-full block"},ue={class:"hidden md:block pl-1"},fe={class:"text-xs leading-5"};function pe(e,t,n,r,o,s){const l=re,c=w;return u(),f(x,null,[i(l,{files:s.filesImg,carid:n.carid,onOnDelete:t[0]||(t[0]=d=>e.$emit("onUpload"))},null,8,["files","carid"]),a("div",{class:"mt-2 flex justify-center rounded-lg border border-dashed border-gray-900/25 px-6 py-10",draggable:"",onDragover:t[2]||(t[2]=(...d)=>s.dragover&&s.dragover(...d)),onDragleave:t[3]||(t[3]=(...d)=>s.dragleave&&s.dragleave(...d)),onDrop:t[4]||(t[4]=(...d)=>s.drop&&s.drop(...d))},[a("div",de,[i(c,{name:"wpf:image-file",size:"4rem"}),a("div",ce,[a("label",he,[a("span",me,h(e.$t("Upload a file")),1),a("input",{id:"file-upload",multiple:"",accept:"image/*",type:"file",ref:"file",onChange:t[1]||(t[1]=(...d)=>s.onChange&&s.onChange(...d)),class:"sr-only"},null,544)]),a("p",ue,h(e.$t("or drag and drop")),1)]),a("p",fe,"PNG, JPG, GIF "+h(e.$t("up to"))+" 10MB",1)])],32)],64)}const ge=y(le,[["render",pe]]),_e={data(){return{form:{id:0,brand:"",model:"",year:"",transmition:"",status:"",color:"",price:"",currency:"",specifications:"",version:"",cylinders:"",type:"",national:!1},inputVideos:[],brands:[],brand:{},files:[],createdBy:{},load_brand:!1}},methods:{handleRemoveVideo(e){let t=[...this.inputVideos];t=t.filter(n=>n.id!==e),this.inputVideos=t,t.length||this.handleAddVideo()},getDataVideo(e,t){return{id:t??"video_"+Date.now(),url:e??""}},handleAddVideo(e,t){let n=[...this.inputVideos];t?(n=n.filter(r=>r.id!==t),n.push(this.getDataVideo(e,t))):n.push(this.getDataVideo(e)),this.inputVideos=n},handleSave(e){if(e.preventDefault(),!this.formValidation()){console.error("[Cars] Form inValid");return}const t=this.getModelData(),n=new C,{toast_error:r,toast_success:o}=g();let s=this.inputVideos.map(c=>c.url);s=s.filter(c=>c),new _().setVideo(`cars/${this.form.id}/videos`,s).then(c=>{console.log("[API] Car videos success upload")}),n.update(this.form.id,t).then(({data:c})=>{c&&(console.log("[Car] Car updated:",c.id),o(this.$t("Car updated")),this.handleClose())}).catch(c=>{console.error("[Car] error:",c==null?void 0:c.message),r(this.$t("Sorry, we have error in server, try again later"))})},getModelData(){return{brand_id:this.form.brand,model:this.form.model,year:this.form.year,transmition:this.form.transmition,status:this.form.status,color:this.form.color,price_base:this.form.price,currency:this.form.currency,specifications:this.form.specifications,version:this.form.version,cylinders:this.form.cylinders,type:this.form.type,national:this.form.national}},formValidation(){const{toast_error:e}=g(),t={...this.form};return t.brand?t.model?t.year?t.transmition?t.status?t.price?!0:(e(this.$t("Please, type price")),!1):(e(this.$t("Please, select a status")),!1):(e(this.$t("Please, select a transmition")),!1):(e(this.$t("Please, type year")),!1):(e(this.$t("Please, type model")),!1):(e(this.$t("Please, select a brand")),!1)},handleFormChange({target:e},t){if(t==="national"){this.form.national=e.checked;return}else if(/^video_.*/i.test(t)){this.handleAddVideo(e.value,t);return}this.form[t]=e.value},handleClose(){return X("/dashboard/cars")},getCar(){if(!this.form.id)return;const e=new C,{toast_error:t}=g();e.get(this.form.id).then(({data:n})=>{this.setDataModel(n),this.brand=(n==null?void 0:n.brand)??{},this.createdBy=(n==null?void 0:n.admin)??{},this.files=n.media}).catch(n=>{console.error("[Car] error:",n.message),t(this.$t("Sorry, we have error in server, try again later"))})},setDataModel(e){var n;if(!e)return;const t={...this.form,id:e.id,brand:((n=e.brand)==null?void 0:n.id)??0,model:e.model,year:e.year,transmition:e.transmition,status:e.status,price:e.price_base,currency:e.currency,specifications:e.specifications,color:e.color,version:e.version,cylinders:e.cylinders,type:e.type,national:!!e.national};if(this.form=t,e.videos&&e.videos.length)e.videos.forEach(r=>{this.handleAddVideo(r.url,`saved_${r.id}`)});else{if(this.inputVideos.length)return;this.handleAddVideo()}},async getBrands(){const e=new P,{data:t}=await e.get(0,{perpage:200});this.brands=t??[],this.load_brand=!1}},computed:{placeholdType(){return this.$t("hatchback")},placeholdColor(){return this.$t("Color")},placeholdModel(){return this.$t("classic jetta")},placeholdVersion(){return this.$t("Version")},dataBrand(){const e=[...this.brands];return e.map(t=>{if(t.id===this.form.brand){t.selected=!0;return}t.selected=!1}),e},dataStatus(){const e=[{id:"for sale",name:this.$t("for sale")},{id:"apart",name:this.$t("apart")},{id:"saled",name:this.$t("saled")}];return e.map((t,n)=>{if(t.id===this.form.status){e[n].selected=!0;return}e[n].selected=!1}),e},dataTransmition(){const e=[{id:"automatic",name:this.$t("automatic")},{id:"standard",name:this.$t("standard")}];return e.map(t=>{if(t.id===this.form.transmition){t.selected=!0;return}t.selected=!1}),e}},watch:{"form.id":function(){this.getCar()}},mounted(){const e=z();this.form.id=e.params.id,this.load_brand=!0,this.getBrands()}},ye={class:"px-4 sm:px-6 md:px-8"},be={class:"flex flex-col md:flex-row items-start"},ve={class:"flex-auto flex w-full text-indigo-900"},xe={class:"text-2xl font-semibold leading-6 ml-2"},Ce={class:"flex space-x-2 justify-end w-full pt-2 md:pt-0"},we={class:"md:space-y-12"},Ve={class:"grid grid-cols-1 gap-x-8 border-b border-gray-900/10 gap-y-10 pb-12 md:grid-cols-3"},Oe={class:"text-base font-semibold leading-7 text-gray-900"},Te={class:"grid md:max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2"},Fe={class:"sm:col-span-4"},De={class:"sm:col-span-3"},ke={class:"sm:col-span-3"},Se={class:"sm:col-span-3"},Ae={class:"sm:col-span-3"},Be={class:"sm:col-span-3"},$e={class:"sm:col-span-3"},Pe={class:"grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3"},Ee={class:"text-base font-semibold leading-7 text-gray-900"},Ie={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2"},Me={class:"sm:col-span-3"},Ue={class:"sm:col-span-3"},Ne={class:"grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3"},Le={class:"text-base font-semibold leading-7 text-gray-900"},je={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2"},Re={class:"sm:col-span-3"},Xe={class:"sm:col-span-3"},ze={class:"sm:col-span-full"},Ge={class:"grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3"},qe={class:"text-base font-semibold leading-7 text-gray-900"},We={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6 md:col-span-2"},He={class:"col-span-full"},Je={class:"grid grid-cols-1 gap-x-8 gap-y-10 border-b border-gray-900/10 pb-12 md:grid-cols-3"},Ye={class:"text-base font-semibold leading-7 text-gray-900"},Ke={class:"grid max-w-2xl grid-cols-1 gap-x-6 gap-y-6 md:content-start md:grid-cols-6 col-span-2"},Qe={class:"md:col-span-5"},Ze={class:"my-3 flex space-x-4"},et=["onClick"],tt={class:"w-full"},st={class:"hidden md:block md:col-span-1 flex justify-end pr-2 text-blue-700"},nt={class:"mt-6 px-2 grid grid-cols-2 md:grid-cols-4 gap-2 md:gap-4"},at=a("div",{class:"hidden md:block md:col-span-2"},null,-1);function ot(e,t,n,r,o,s){const l=w,c=E,d=U,b=N,p=L,T=I,F=se,D=M,k=ge,S=j,A=R,B=W;return u(),G(B,null,{default:q(()=>[a("div",ye,[a("div",be,[a("div",ve,[i(l,{name:"wpf:car-rental",size:"1.5rem"}),a("h2",xe,h(o.brand.name)+" - "+h(o.form.model),1)]),a("div",Ce,[i(c,{large:"",onOnClick:s.handleClose},null,8,["onOnClick"])])]),a("form",{class:"md:-mx-4 mt-4 md:mt-10",onSubmit:t[2]||(t[2]=(...m)=>s.handleSave&&s.handleSave(...m))},[a("div",we,[a("div",Ve,[a("div",null,[a("h2",Oe,h(e.$t("Basic")),1)]),a("div",Te,[a("div",Fe,[i(d,{label:"Brand",to:"brand"}),i(b,{data:s.dataBrand,id:"brand",onOnChange:s.handleFormChange},null,8,["data","onOnChange"]),H(" "+h(o.load_brand?e.$t("Loading"):null),1)]),a("div",De,[i(d,{label:"Model",to:"model"}),i(p,{id:"model",defaultText:o.form.model,placeholder:s.placeholdModel,onOnChange:s.handleFormChange},null,8,["defaultText","placeholder","onOnChange"])]),a("div",ke,[i(d,{label:"Year",to:"year"}),i(p,{id:"year",defaultText:o.form.year,placeholder:"2017",onOnChange:s.handleFormChange},null,8,["defaultText","onOnChange"])]),a("div",Se,[i(d,{label:"Version",to:"version",optional:""}),i(p,{id:"version",defaultText:o.form.version,placeholder:s.placeholdVersion,onOnChange:s.handleFormChange},null,8,["defaultText","placeholder","onOnChange"])]),a("div",Ae,[i(d,{label:"Price",to:"price"}),i(T,{id:"price",defaultValue:o.form.price,defaultCurrency:o.form.currency,onOnChange:s.handleFormChange,onOnChangeCurrency:s.handleFormChange},null,8,["defaultValue","defaultCurrency","onOnChange","onOnChangeCurrency"])]),a("div",Be,[i(d,{label:"Status",to:"status"}),i(b,{data:s.dataStatus,id:"status",onOnChange:s.handleFormChange},null,8,["data","onOnChange"])]),a("div",$e,[i(F,{id:"national",text:"National",defaultValue:o.form.national,onOnChange:s.handleFormChange},null,8,["defaultValue","onOnChange"])])])]),a("div",Pe,[a("div",null,[a("h2",Ee,h(e.$t("Engine")),1)]),a("div",Ie,[a("div",Me,[i(d,{label:"Transmition",to:"transmition"}),i(b,{data:s.dataTransmition,id:"transmition",onOnChange:s.handleFormChange},null,8,["data","onOnChange"])]),a("div",Ue,[i(d,{label:"Cylinders",to:"cylinders"}),i(p,{id:"cylinders",defaultText:o.form.cylinders,placeholder:"V4",onOnChange:s.handleFormChange},null,8,["defaultText","onOnChange"])])])]),a("div",Ne,[a("div",null,[a("h2",Le,h(e.$t("Details")),1)]),a("div",je,[a("div",Re,[i(d,{label:"Color",to:"color",optional:""}),i(p,{id:"color",defaultText:o.form.color,placeholder:s.placeholdColor,onOnChange:s.handleFormChange},null,8,["defaultText","placeholder","onOnChange"])]),a("div",Xe,[i(d,{label:"Type",to:"type",optional:""}),i(p,{id:"type",defaultText:o.form.type,placeholder:s.placeholdType,onOnChange:s.handleFormChange},null,8,["defaultText","placeholder","onOnChange"])]),a("div",ze,[i(d,{label:"Specifications",to:"specifications",optional:""}),i(D,{id:"specifications",defaultText:o.form.specifications,onOnChange:s.handleFormChange},null,8,["defaultText","onOnChange"])])])]),a("div",Ge,[a("div",null,[a("h2",qe,h(e.$t("Images")),1)]),a("div",We,[a("div",He,[i(d,{label:"Upload images",to:"file-upload",optional:""}),i(k,{url:`cars/${o.form.id}/media`,defaultFiles:o.files,carid:o.form.id,onOnUpload:t[0]||(t[0]=m=>s.getCar())},null,8,["url","defaultFiles","carid"])])])]),a("div",Je,[a("div",null,[a("h2",Ye,h(e.$t("Videos")),1)]),a("div",Ke,[a("div",Qe,[(u(!0),f(x,null,V(o.inputVideos,(m,$)=>(u(),f("div",Ze,[m.url?(u(),f("div",{key:0,class:"hidden md:block pt-6 text-gray-700 cursor-pointer",onClick:it=>s.handleRemoveVideo(m.id)},[i(l,{name:"material-symbols:delete-sweep-outline",size:"1.5rem"})],8,et)):O("",!0),a("div",tt,[i(d,{label:"Url",to:m.id,optional:!$},null,8,["to","optional"]),i(p,{id:m.id,defaultText:m.url,placeholder:"https://www.youtube.com/watch?v=XXXXXXX",onOnChange:s.handleFormChange},null,8,["id","defaultText","onOnChange"])])]))),256))]),a("div",st,[i(l,{name:"material-symbols:add-box",size:"2rem",onClick:t[1]||(t[1]=m=>s.handleAddVideo())})])])])]),a("div",nt,[at,i(S,{large:"",label:"Cerrar",onOnClick:s.handleClose},null,8,["onOnClick"]),i(A)])],32)])]),_:1})}const gt=y(_e,[["render",ot]]);export{gt as default};
